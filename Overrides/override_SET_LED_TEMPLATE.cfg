[gcode_macro SET_LED_TEMPLATE]
rename_existing: SET_LED_TEMPLATE_BASE
gcode:
  {% set NOZZLE = false %}
  {% set STATUS = false %}
  {% set ON = false %}
  
  {% if params.INDEX is defined and (params.INDEX == '1,3' or params.INDEX == '1-3|2') %}
    {% set NOZZLE = true %}
  {% endif %}

  {% if params.INDEX is defined and params.INDEX == '2' %}
    {% set STATUS = true %}
  {% endif %}

  {% if params.TEMPLATE is defined and params.TEMPLATE != '' %}
    {% set ON = true %}
  {% endif %}

  {% if params.LED is defined and params.LED|string == 'Toolhead' %}
    {% if NOZZLE %}
      {% if ON %}
        SET_GCODE_VARIABLE MACRO=NOZZLE_LIGHT VARIABLE=value value=1
      {% else %}
        SET_GCODE_VARIABLE MACRO=NOZZLE_LIGHT VARIABLE=value value=0
      {% endif %}
    {% endif %}

    {% if STATUS %}
      {% if ON %}
        SET_GCODE_VARIABLE MACRO=STATUS_LIGHT VARIABLE=value value=1
      {% else %}
        SET_GCODE_VARIABLE MACRO=STATUS_LIGHT VARIABLE=value value=0
      {% endif %}
    {% endif %}
  {% endif %}
  SET_LED_TEMPLATE_BASE {rawparams}
