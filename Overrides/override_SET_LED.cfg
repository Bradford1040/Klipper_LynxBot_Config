[gcode_macro SET_LED]
rename_existing: SET_LED_BASE
gcode:
  {% set override = false %}
  {% set nozzle = false %}
  {% set status = false %}
  
  {% if params.INDEX is defined and params.INDEX == '1,3' %}
    {% set override = true %}
    {% set nozzle = true %}
  {% endif %}

  {% if params.INDEX is defined and params.INDEX == '2' %}
    {% set override = true %}
    {% set status = true %}
  {% endif %}
  
  {% if params.LED is defined and params.LED|string == 'Toolhead' and override %}
    {% set RED = 0 %}
    {% set GREEN = 0 %}
    {% set BLUE = 0 %}
    {% set WHITE = 0 %}

    {% if params.RED is defined and params.RED|float > 0 %}
      {% set RED = 1 %}
    {% endif %}

    {% if params.GREEN is defined and params.GREEN|float > 0 %}
      {% set GREEN = 1 %}
    {% endif %}

    {% if params.BLUE is defined and params.BLUE|float > 0 %}
      {% set BLUE = 1 %}
    {% endif %}

    {% if params.WHITE is defined and params.WHITE|float > 0 %}
      {% set WHITE = 1 %}
    {% endif %}

    {% if RED|int != 0 or GREEN|int != 0 or BLUE|int != 0 or WHITE|int != 0 %}
      {% if nozzle %}
        SET_GCODE_VARIABLE MACRO=NOZZLE_LIGHT VARIABLE=value value=1
      {% endif %}

      {% if status %}
        SET_GCODE_VARIABLE MACRO=STATUS_LIGHT VARIABLE=value value=1
      {% endif %}
    {% else %}
      {% if nozzle %}
        SET_GCODE_VARIABLE MACRO=NOZZLE_LIGHT VARIABLE=value value=0
      {% endif %}

      {% if status %}
        SET_GCODE_VARIABLE MACRO=STATUS_LIGHT VARIABLE=value value=0
      {% endif %}
    {% endif %}
  {% endif %}
  SET_LED_BASE {rawparams}
