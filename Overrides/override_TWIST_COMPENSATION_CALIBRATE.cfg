[gcode_macro TWIST_COMPENSATION_CALIBRATE]
gcode:
    {% set N_POINTS = params.N_POINTS|default(3)|int %}
    AXIS_TWIST_COMPENSATION_CALIBRATE N_POINTS={N_POINTS}

[gcode_macro AXIS_TWIST_COMPENSATION_CALIBRATE]
rename_existing: AXIS_TWIST_COMPENSATION_CALIBRATE_BASE
gcode:
    SET_GCODE_OFFSET Z=0.00

    BED_MESH_CLEAR

    LOCK_DOCKING
    G28 P0

    _CHECK_PROBE state=attached

    PROBE_BASE

    AXIS_TWIST_COMPENSATION_CALIBRATE {% for p in params
                %}{'%s=%s ' % (p, params[p])}{%
               endfor %}
    
    UNLOCK_DOCKING
    DOCK_PROBE RETURN_TO_POSITION=FALSE
