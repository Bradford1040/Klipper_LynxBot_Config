[gcode_macro CALIBRATE_ENDSTOP]
gcode:
    Z_ENDSTOP_CALIBRATE {% for p in params
                %}{'%s=%s ' % (p, params[p])}{%
               endfor %}

[gcode_macro Z_ENDSTOP_CALIBRATE]
rename_existing: Z_ENDSTOP_CALIBRATE_BASE
gcode:
    BED_MESH_CLEAR

    G28 X0 Y0 Z0

    CENTER Z=20

    Z_ENDSTOP_CALIBRATE_BASE {% for p in params
                %}{'%s=%s ' % (p, params[p])}{%
               endfor %}
  