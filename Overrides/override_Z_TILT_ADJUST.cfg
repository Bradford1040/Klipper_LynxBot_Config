[gcode_macro Z_TILT_ADJUST]
rename_existing: Z_TILT_ADJUST_BASE
gcode:
    {% if params.CONDITIONAL is defined %}
      {% if params.CONDITIONAL|string != 'TRUE' or printer['gcode_macro _HOMING_STATUS'].z_tilt|int != 1 %}
        ATTACH_PROBE RETURN_TO_POSITION=FALSE

        Z_TILT_ADJUST_BASE {% for p in params
                    %}{'%s=%s ' % (p, params[p])}{%
                   endfor %}

        SET_GCODE_VARIABLE MACRO=_HOMING_STATUS VARIABLE=z_tilt VALUE=1

        DOCK_PROBE RETURN_TO_POSITION=FALSE
      {% endif %}
    {% endif %}
