  [display_template bed_heat]
param_target_temp: 60
param_base_temp: 0
text:
  {% set ratio = (printer.heater_bed.temperature - param_base_temp) / (param_target_temp - param_base_temp)|float %}
  {% if ratio < 0 %}
    {% set ratio = 0 %}
  {% endif %}
  {% if ratio > 1 %}
    {% set ratio = 1 %}
  {% endif %}
  {ratio}, 0.0, {1 - ratio}, 0.0

[display_template nozzle_heat]
param_target_temp: 210
param_base_temp: 0
text:
  {% set ratio = (printer.extruder.temperature - param_base_temp) / (param_target_temp - param_base_temp)|float %}
  {% if ratio < 0 %}
    {% set ratio = 0 %}
  {% endif %}
  {% if ratio > 1 %}
    {% set ratio = 1 %}
  {% endif %}
  {ratio}, 0.0, {1 - ratio}, 0.0


[display_template klicky_state]
text:
  {% if printer["gcode_macro _KLICKY_DATABASE"].docking_locked and printer["gcode_macro _KLICKY_DATABASE"].attaching_locked %}
    {% set RED = 255|int %}
    {% set GREEN = 0|int %}
    {% set BLUE = 255|int %}
    {% set WHITE = 0|int %}
    {% set BRIGHTNESS = 25|int %}
  {% elif printer["gcode_macro _KLICKY_DATABASE"].docking_locked %}
    {% set RED = 0|int %}
    {% set GREEN = 255|int %}
    {% set BLUE = 255|int %}
    {% set WHITE = 0|int %}
    {% set BRIGHTNESS = 25|int %}
  {% elif printer["gcode_macro _KLICKY_DATABASE"].attaching_locked %}
    {% set RED = 0|int %}
    {% set GREEN = 0|int %}
    {% set BLUE = 255|int %}
    {% set WHITE = 0|int %}
    {% set BRIGHTNESS = 25|int %}
  {% else %}
    {% set RED = 246|int %}
    {% set GREEN = 97|int %}
    {% set BLUE = 12|int %}
    {% set WHITE = 0|int %}
    {% set BRIGHTNESS = 25|int %}
  {% endif %}

  {% set RED = ((RED|int/255)|float * BRIGHTNESS)|float / 255 |float %}
  {% set GREEN = ((GREEN|int/255)|float * BRIGHTNESS)|float / 255 |float %}
  {% set BLUE = ((BLUE|int/255)|float * BRIGHTNESS)|float / 255 |float %}
  {% set WHITE = ((WHITE|int/255)|float * BRIGHTNESS)|float / 255 |float %}

  {RED}, {GREEN}, {BLUE}, {WHITE}

[led_effect critical_error]
leds:
    neopixel:Toolhead
layers:
    strobe         1  1.5   add        (1.0,  1.0, 1.0)
    breathing      2  0     difference (0.95, 0.0, 0.0)
    static         1  0     top        (1.0,  0.0, 0.0)
autostart:                             false
frame_rate:                            24
run_on_error:                          true
